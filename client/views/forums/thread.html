<template name="thread">
  <div class="thread common-page">
    <ul class="breadcrumb">
      <li><a href="/forums">Forums</a> <span class="divider">/</span></li>
      <li><a href="/forum/{{forum.slug}}/">{{forum.name}}</a> <span class="divider">/</span></li>
      <li class="active">{{thread.title}}</li>
    </ul>
    {{> msg msg}}
    {{#with thread}}
    <div class="title">
      <span class="topic">{{t "TOPIC"}}:</span>
      <h3>{{title}}</h3>
    </div>
    <div class="controls">
      {{> pagination pagingData}}
      {{#if $neq type "deleted"}}
      <button class="btn btn-main reply-btn"><i class="icon-plus icon-white"></i> ADD A REPLY</button>
      {{#if isOwn}}
      <a href="/thread/edit/{{thread._id}}/"><button class="btn btn-main"><i class="icon-edit icon-white"></i> Edit</button></a>
      {{/if}}
      {{/if}}
    </div>
    <div class="content-holder">
      {{#if isFirstPage}}
      {{#isolate}}
      <div class="holder clearfix">
        <div class="user-panel">
          <div class="avatar">
            <a href="/user/{{op.username}}"><img src="{{gravatarUrl op.email}}" /></a>
          </div>
          <div class="user-info">
            <div class="username"><a href="/user/{{op.username}}">{{op.username}}</a></div>
            <div class="posts">{{null2zero op.meta.posts}} {{t "Posts"}}</div>
          </div>
        </div>
        <div class="body">
        {{#if $eq type "deleted"}}
          <span class="label"><em>{{t "This thread was deleted!"}}</em></span>
        {{else}}
          {{#marked}}{{{body}}}{{/marked}}
        {{/if}}
        </div>
      </div>
      {{/isolate}}
      {{/if}}
      {{#each replies}}
      {{#isolate}}
      <div class="reply holder clearfix">
        <div class="user-panel">
          <div class="avatar">
            <a href="/user/{{user.username}}"><img src="{{gravatarUrl user.email}}" /></a>
          </div>
          <div class="user-info">
            <div class="username"><a href="/user/{{user.username}}">{{user.username}}</a></div>
            <div class="posts">{{null2zero user.meta.posts}} {{t "Posts"}}</div>
          </div>
        </div>
        <div class="body">
        {{#if $eq user._id currentUser._id}}
        <div class="controls">
          <span class="label label-important edit" data-reply-id="{{_id}}"><i class="icon-pencil icon-white"></i> Edit</span>
          <span class="label label-important delete" data-reply-id="{{_id}}"><i class="icon-trash icon-white"></i> Delete</span>
        </div>
        {{/if}}
        {{#if $eq type "deleted"}}
          <span class="label"><em>{{t "This reply was deleted!"}}</em></span>
        {{else}}
          {{#marked}}{{{body}}}{{/marked}}
        {{/if}}
        </div>
      </div>
      {{/isolate}}
      {{/each}}
    </div>
    {{/with}}
  </div>
  <div id="replyModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="replyModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
      <h3 id="replyModalLabel">{{t "Post Reply"}}</h3>
    </div>
    <div class="modal-body">
      <div>
        {{#isolate}}
        {{> msg modalMsg}}
        {{/isolate}}
        <textarea id="replyBody" rows="4" placeholder="{{t "Markdown is supported"}}"></textarea>
        <div class="preview-divider panel-text">Preview:</div>
        <div class="preview-holder">
          {{#isolate}}
          {{#marked}}{{{get_ps "replyPreview"}}}{{/marked}}
          {{/isolate}}
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">{{t "Close"}}</button>
      <button class="btn btn-main save-reply">{{t "Save"}}</button>
    </div>
  </div>
</template>
